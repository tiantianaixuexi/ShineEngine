{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/shine-engine/module-schema.json",
  "title": "Shine Engine Module Configuration",
  "description": "Schema for Shine Engine module configuration files",
  "type": "object",
  "required": ["name"],
  "properties": {
    "name": {
      "type": "string",
      "description": "模块名称，必须与 JSON 文件名相同",
      "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$"
    },
    "files": {
      "type": "array",
      "description": "该模块包含的源文件列表。支持 .cpp、.ixx、.cppm、.h、.hpp 等",
      "items": {
        "type": "string",
        "pattern": "^src/.*\\.(cpp|h|hpp|ixx|cppm|inl)$"
      },
      "minItems": 0
    },
    "files_module": {
      "type": "array",
      "description": "启用 C++20 模块时使用的文件列表（仅当 SHINE_BUILD_MODULE=ON 时生效）。通常包含 .ixx 模块接口文件",
      "items": {
        "type": "string",
        "pattern": "^src/.*\\.(ixx|cppm)$"
      },
      "minItems": 0
    },
    "files_header": {
      "type": "array",
      "description": "不使用 C++20 模块时使用的文件列表（仅当 SHINE_BUILD_MODULE=OFF 时生效）。通常包含 .h 头文件",
      "items": {
        "type": "string",
        "pattern": "^src/.*\\.(h|hpp)$"
      },
      "minItems": 0
    },
    "files_windows": {
      "type": "array",
      "description": "仅在 Windows 平台使用的文件列表",
      "items": {
        "type": "string",
        "pattern": "^src/.*\\.(cpp|h|hpp|ixx|cppm|inl)$"
      },
      "minItems": 0
    },
    "files_wasm": {
      "type": "array",
      "description": "仅在 WebAssembly (Emscripten) 平台使用的文件列表",
      "items": {
        "type": "string",
        "pattern": "^src/.*\\.(cpp|h|hpp|ixx|cppm|inl)$"
      },
      "minItems": 0
    },
    "files_android": {
      "type": "array",
      "description": "仅在 Android 平台使用的文件列表",
      "items": {
        "type": "string",
        "pattern": "^src/.*\\.(cpp|h|hpp|ixx|cppm|inl)$"
      },
      "minItems": 0
    },
    "dirs": {
      "type": "array",
      "description": "自动收集指定目录下所有相关文件的目录列表。递归搜索目录及其子目录",
      "items": {
        "type": "string",
        "pattern": "^src/.*"
      },
      "minItems": 0
    },
    "deps": {
      "type": "array",
      "description": "依赖的其他 JSON 模块（按文件名）。支持传递依赖（自动解析）",
      "items": {
        "type": "string",
        "description": "依赖的模块名称（不含 .json 扩展名）"
      },
      "minItems": 0
    },
    "imports": {
      "type": "array",
      "description": "⚠️ 已废弃，请使用 deps 替代",
      "deprecated": true,
      "items": {
        "type": "string"
      },
      "minItems": 0
    },
    "defines": {
      "type": "array",
      "description": "编译时宏定义列表",
      "items": {
        "type": "string",
        "description": "宏定义名称，例如：ENABLE_LOGGING"
      },
      "minItems": 0
    },
    "type": {
      "description": "模块构建类型，默认 \"lib\"",
      "oneOf": [
        {
          "type": "string",
          "enum": ["lib", "static", "shared", "exe", "third"],
          "default": "lib"
        },
        {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["lib", "static", "shared", "exe", "third"]
          },
          "minItems": 1,
          "uniqueItems": true
        }
      ]
    },
    "platform": {
      "type": "array",
      "description": "仅在指定平台启用该模块。可用值: Windows, Wasm, Linux 等",
      "items": {
        "type": "string",
        "enum": ["Windows", "Wasm", "Linux", "macOS", "Android", "iOS"]
      },
      "minItems": 0,
      "uniqueItems": true
    },
    "link": {
      "type": "object",
      "description": "第三方库链接配置，仅对 type: \"third\" 的模块有效",
      "properties": {
        "debug": {
          "type": "object",
          "description": "Debug 构建配置",
          "properties": {
            "lib": {
              "type": "array",
              "description": "要链接的库文件（.lib/.a）",
              "items": {
                "type": "string",
                "pattern": ".*\\.(lib|a)$"
              }
            },
            "dll": {
              "type": "array",
              "description": "要复制的动态库文件（.dll/.so）",
              "items": {
                "type": "string",
                "pattern": ".*\\.(dll|so|dylib)$"
              }
            }
          },
          "additionalProperties": false
        },
        "release": {
          "type": "object",
          "description": "Release 构建配置",
          "properties": {
            "lib": {
              "type": "array",
              "description": "要链接的库文件（.lib/.a）",
              "items": {
                "type": "string",
                "pattern": ".*\\.(lib|a)$"
              }
            },
            "dll": {
              "type": "array",
              "description": "要复制的动态库文件（.dll/.so）",
              "items": {
                "type": "string",
                "pattern": ".*\\.(dll|so|dylib)$"
              }
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "comment": {
      "type": "string",
      "description": "模块注释说明（可选）"
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "name": "math",
      "dirs": ["src/math"],
      "type": "static",
      "deps": ["shine_define"]
    },
    {
      "name": "base64",
      "type": "static",
      "files": [
        "src/util/base64/base64.cpp"
      ],
      "files_module": [
        "src/util/base64/base64.ixx"
      ],
      "files_header": [
        "src/util/base64/base64.h"
      ],
      "comment": "使用条件文件：启用模块时使用 .ixx，否则使用 .h"
    },
    {
      "name": "texture",
      "files": [
        "src/image/Texture.h",
        "src/image/Texture.cpp"
      ],
      "type": "lib",
      "deps": ["shine_define"],
      "platform": ["Windows", "Wasm"]
    },
    {
      "name": "fmt",
      "files": [
        "src/third/fmt/format.h"
      ],
      "type": "third",
      "link": {
        "release": {
          "lib": ["fmt.lib"]
        },
        "debug": {
          "lib": ["fmtd.lib"]
        }
      },
      "defines": ["FMT_SHARED"]
    },
    {
      "name": "EngineLauncher",
      "files": ["src/launcher.cpp"],
      "type": "exe",
      "deps": ["fmt", "imgui"]
    }
  ]
}

